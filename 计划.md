# 个人资源仓库网站 - 项目计划

## 项目概述

构建一个**个人资源仓库网站**，用于存储、管理和便捷访问各类资源（文档、视频等），支持预览和下载。

**适用场景**：个人使用，本地部署，无需用户认证

## 需求分析

### 核心功能
| 功能模块 | 描述 | 优先级 |
|---------|------|-------|
| 资源上传 | 支持单文件/批量上传，拖拽上传 | P0 |
| 资源浏览 | 列表/网格视图，分页 | P0 |
| 在线预览 | PDF、图片、视频预览 | P0 |
| 资源下载 | 单文件/批量下载 | P0 |
| 分类管理 | 文件夹/目录结构 | P1 |
| 标签系统 | 自定义标签，多标签筛选 | P1 |
| 搜索功能 | 文件名、描述搜索 | P1 |

### 支持的资源类型
- **文档类**：PDF, DOC, DOCX, PPT, PPTX, TXT, MD
- **图片类**：JPG, PNG, GIF, WEBP, SVG
- **视频类**：MP4, WEBM, MOV, AVI
- **音频类**：MP3, WAV, FLAC
- **压缩包**：ZIP, RAR, 7Z

## 技术栈

### 前端
| 技术 | 版本 | 说明 |
|-----|------|------|
| Vue | 3.x | 渐进式框架 |
| Vite | 5.x | 构建工具 |
| TypeScript | 5.x | 类型安全 |
| Pinia | 2.x | 状态管理 |
| Vue Router | 4.x | 路由管理 |
| Element Plus | 2.x | UI 组件库 |
| Axios | 1.x | HTTP 客户端 |

### 后端
| 技术 | 版本 | 说明 |
|-----|------|------|
| Python | 3.11+ | 运行环境 |
| FastAPI | 0.104+ | Web 框架 |
| SQLAlchemy | 2.x | ORM |
| Pydantic | 2.x | 数据验证 |
| Alembic | 1.x | 数据库迁移 |
| Uvicorn | 0.24+ | ASGI 服务器 |
| aiofiles | - | 异步文件操作 |

### 数据库
| 技术 | 版本 | 说明 |
|-----|------|------|
| MySQL | 8.0+ | 关系型数据库 |

## 系统架构

```
┌─────────────────────────────────────────────────────┐
│                      Nginx                          │
│                   (反向代理)                         │
└─────────────────────────────────────────────────────┘
                          │
          ┌───────────────┴───────────────┐
          ▼                               ▼
┌──────────────────────┐      ┌──────────────────────┐
│      前端容器         │      │      后端容器         │
│   Vue 3 + Vite       │◄────►│   FastAPI + Uvicorn  │
│   (静态文件服务)      │      │   (RESTful API)       │
└──────────────────────┘      └──────────────────────┘
                                         │
          ┌──────────────────────────────┴──────────────────────────────┐
          ▼                              ▼                              ▼
┌──────────────────┐        ┌──────────────────┐        ┌──────────────────┐
│    MySQL 容器     │        │   文件存储卷      │        │                  │
│   资源元数据      │        │  /data/uploads   │        │                  │
└──────────────────┘        └──────────────────┘        └──────────────────┘
```

## 项目结构

```
pocket/
├── frontend/                    # 前端项目
│   ├── src/
│   │   ├── api/                # API 调用
│   │   ├── components/         # 公共组件
│   │   ├── views/              # 页面视图
│   │   ├── stores/             # Pinia 状态
│   │   ├── router/             # 路由配置
│   │   ├── utils/              # 工具函数
│   │   └── assets/             # 静态资源
│   ├── public/
│   ├── index.html
│   ├── vite.config.ts
│   └── package.json
│
├── backend/                     # 后端项目
│   ├── app/
│   │   ├── api/                # API 路由
│   │   ├── models/             # SQLAlchemy 模型
│   │   ├── schemas/            # Pydantic 模式
│   │   ├── crud/               # 数据库操作
│   │   ├── core/               # 核心配置
│   │   ├── utils/              # 工具函数
│   │   └── main.py             # 应用入口
│   ├── alembic/                # 数据库迁移
│   ├── tests/                  # 测试
│   ├── requirements.txt
│   └── Dockerfile
│
├── docker/                      # Docker 配置
│   ├── nginx.conf
│   └── init.sql
│
├── data/                        # 数据持久化
│   └── uploads/                 # 上传文件
│
├── docker-compose.yml           # Docker 编排
├── .env.example                 # 环境变量示例
└── README.md
```

## 数据模型设计

```sql
-- 资源表
CREATE TABLE resources (
    id              INT AUTO_INCREMENT PRIMARY KEY,
    name            VARCHAR(255) NOT NULL COMMENT '资源名称',
    original_name   VARCHAR(255) NOT NULL COMMENT '原始文件名',
    file_path       VARCHAR(500) NOT NULL COMMENT '存储路径',
    file_size       BIGINT COMMENT '文件大小(字节)',
    mime_type       VARCHAR(100) COMMENT 'MIME类型',
    file_type       VARCHAR(50) COMMENT '文件类型: document/image/video/audio/archive',
    category_id     INT NULL REFERENCES categories(id),
    description     TEXT COMMENT '描述',
    download_count  INT DEFAULT 0 COMMENT '下载次数',
    is_deleted      BOOLEAN DEFAULT FALSE COMMENT '软删除',
    created_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_category (category_id),
    INDEX idx_type (file_type),
    INDEX idx_created (created_at),
    FULLTEXT INDEX idx_search (name, description)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 分类表
CREATE TABLE categories (
    id          INT AUTO_INCREMENT PRIMARY KEY,
    name        VARCHAR(100) NOT NULL COMMENT '分类名称',
    parent_id   INT NULL COMMENT '父分类ID',
    path        VARCHAR(500) COMMENT '完整路径',
    sort_order  INT DEFAULT 0 COMMENT '排序',
    icon        VARCHAR(50) COMMENT '图标',
    created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_parent (parent_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 标签表
CREATE TABLE tags (
    id          INT AUTO_INCREMENT PRIMARY KEY,
    name        VARCHAR(50) NOT NULL UNIQUE COMMENT '标签名称',
    color       VARCHAR(7) DEFAULT '#409EFF' COMMENT '颜色',
    created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 资源标签关联表
CREATE TABLE resource_tags (
    resource_id INT NOT NULL REFERENCES resources(id) ON DELETE CASCADE,
    tag_id      INT NOT NULL REFERENCES tags(id) ON DELETE CASCADE,
    PRIMARY KEY (resource_id, tag_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

## API 设计

```
# 资源管理
GET    /api/resources               # 资源列表（分页、筛选）
POST   /api/resources               # 上传资源
GET    /api/resources/{id}          # 资源详情
PUT    /api/resources/{id}          # 更新资源信息
DELETE /api/resources/{id}          # 删除资源
DELETE /api/resources/batch         # 批量删除
GET    /api/resources/{id}/download # 下载资源
GET    /api/resources/{id}/preview  # 预览资源（重定向到文件）

# 分类管理
GET    /api/categories              # 分类树
POST   /api/categories              # 创建分类
PUT    /api/categories/{id}         # 更新分类
DELETE /api/categories/{id}         # 删除分类

# 标签管理
GET    /api/tags                    # 标签列表
POST   /api/tags                    # 创建标签
DELETE /api/tags/{id}               # 删除标签
PUT    /api/resources/{id}/tags     # 更新资源标签

# 搜索与统计
GET    /api/search                  # 搜索资源
GET    /api/stats                   # 统计信息（文件数、总大小等）
```

## 界面设计

### 页面结构
```
├── 首页 (/)
│   ├── 资源统计卡片（文件数、总大小、类型分布）
│   ├── 最近上传
│   └── 快速搜索
│
├── 资源列表 (/resources)
│   ├── 侧边栏（分类树）
│   ├── 搜索栏
│   ├── 筛选器（标签、类型、日期）
│   └── 资源网格/列表视图切换
│
├── 资源详情 (/resources/:id)
│   ├── 预览区域
│   │   ├── PDF 预览器（pdf.js）
│   │   ├── 图片查看器
│   │   └── 视频播放器
│   ├── 元信息面板
│   └── 操作按钮（下载、编辑、删除）
│
├── 上传页面 (/upload)
│   └── 拖拽上传区 + 进度显示
│
└── 分类管理 (/categories)
    └── 分类树编辑器
```

## Docker 部署配置

### docker-compose.yml
```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: pocket-mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: pocket
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
    volumes:
      - mysql-data:/var/lib/mysql
      - ./docker/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "3306:3306"
    networks:
      - pocket-net

  backend:
    build: ./backend
    container_name: pocket-backend
    environment:
      DATABASE_URL: mysql+pymysql://${MYSQL_USER}:${MYSQL_PASSWORD}@mysql:3306/pocket
      UPLOAD_DIR: /data/uploads
    volumes:
      - ./data/uploads:/data/uploads
    depends_on:
      - mysql
    networks:
      - pocket-net

  frontend:
    build: ./frontend
    container_name: pocket-frontend
    depends_on:
      - backend
    networks:
      - pocket-net

  nginx:
    image: nginx:alpine
    container_name: pocket-nginx
    volumes:
      - ./docker/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./frontend/dist:/usr/share/nginx/html:ro
      - ./data/uploads:/data/uploads:ro
    ports:
      - "80:80"
    depends_on:
      - frontend
      - backend
    networks:
      - pocket-net

volumes:
  mysql-data:

networks:
  pocket-net:
    driver: bridge
```

### .env.example
```bash
# MySQL
MYSQL_ROOT_PASSWORD=your_root_password
MYSQL_USER=pocket
MYSQL_PASSWORD=your_password
```

## 实施计划

### Phase 1: 项目初始化（3-5天）
- [ ] 创建前后端项目结构
- [ ] 配置 Docker 开发环境
- [ ] 设计数据库表结构
- [ ] 搭建基础 API 框架
- [ ] 搭建前端基础页面和路由

### Phase 2: 核心功能（1-2周）
- [ ] 文件上传功能（拖拽、多文件、进度条）
- [ ] 资源列表与分页
- [ ] 在线预览（PDF、图片、视频）
- [ ] 文件下载功能

### Phase 3: 组织管理（1周）
- [ ] 分类系统（树形结构）
- [ ] 标签系统
- [ ] 搜索功能（MySQL 全文索引）
- [ ] 批量操作（删除、移动、添加标签）

## 开发启动

### Docker 部署
```bash
# 复制环境变量
cp .env.example .env

# 编辑 .env 文件，设置密码

# 启动所有服务
docker-compose up -d

# 查看日志
docker-compose logs -f backend

# 数据库迁移
docker-compose exec backend alembic upgrade head
```

### 前端开发（独立运行）
```bash
cd frontend
npm install
npm run dev
```

### 后端开发（独立运行）
```bash
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload --port 8000
```

---

## 确认项

| 项目 | 状态 |
|-----|------|
| 技术栈：Vue 3 + FastAPI + MySQL | ✅ |
| 部署方式：本地 Docker | ✅ |
| 用户认证：不需要 | ✅ |
| 搜索方案：MySQL 全文索引 | ✅ |

准备好后可以开始项目初始化。
